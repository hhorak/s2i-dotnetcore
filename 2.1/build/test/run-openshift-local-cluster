#!/bin/bash
#
# Test the .NET image in OpenShift (local cluster)
#
# IMAGE_NAME specifies a name of the candidate image used for testing.
# The image has to be available before this script is executed.
# VERSION specifies the major version of the .NET in format of X.Y
# OS specifies RHEL version (e.g. OS=rhel7)
#
# This file is deliberately kept same across different versions of .NET image

THISDIR=$(dirname ${BASH_SOURCE[0]})

source ${THISDIR}/test-lib-dotnet.sh

set -eo nounset

trap ct_os_cleanup EXIT SIGINT

ct_os_check_compulsory_vars

ct_os_cluster_up

export CT_NAMESPACE=openshift
test_dotnet_integration "${IMAGE_NAME}" "${VERSION}"

# test with a released image and integrated template
export CT_SKIP_UPLOAD_IMAGE=true
case ${OS} in
  rhel7)
    case ${VERSION} in
      1*) IMAGE_NAME=dotnet/dotnetcore-${VERSION//./}-rhel7 ;;
      2*) IMAGE_NAME=dotnet/dotnet-${VERSION//./}-rhel7 ;;
    esac
  *) ;;
esac
test_dotnet_integration dotnet "${VERSION}" "registry.access.redhat.com/${IMAGE_NAME}"

OS_TESTSUITE_RESULT=0

